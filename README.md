# wire_go_template

A template Go project demonstrating clean dependency injection using [Google Wire](https://github.com/google/wire).

## Overview

This project provides a simple structure for Go applications that require dependency injection. It uses interfaces and Google's Wire to manage dependencies for cache and SQL repositories, making the codebase modular, testable, and easy to extend.

## Directory Structure

```
wire_go_template/
├── cmd/
│   └── main.go            # Application entry point
├── inject/
│   ├── injector.go        # Interfaces, implementations, and constructors
│   ├── injector_test.go   # Unit tests for repositories and DI
│   ├── wire.go            # Wire provider sets and injector definition
│   └── wire_gen.go        # Auto-generated by Wire
├── go.mod                 # Go module definition
├── go.sum                 # Go module checksums
├── instructions.txt       # Setup instructions
└── README.md              # Project documentation
```

## Dependency Injection with Wire

- **injector.go**: Defines interfaces and implementations for cache and SQL repositories, as well as the `AppContext` struct.
- **wire.go**: Sets up provider sets and the `InitializeEvent` injector function using Wire.
- **wire_gen.go**: Generated by Wire, contains the actual wiring logic.

## Setup

1. **Clone the repository:**
   ```sh
   git clone <your-repo-url>
   cd wire_go_template
   ```
2. **Initialize Go modules and tidy dependencies:**
   ```sh
   go mod init go-wire
   go mod tidy
   ```
3. **Install Wire:**
   ```sh
   go get github.com/google/wire/cmd/wire
   ```
4. **Generate the wire injector:**
   ```sh
   go run github.com/google/wire/cmd/wire
   ```
   > Ensure `//go:build wireinject` is present in `wire.go` as required by Wire.

## Usage

Run the application:
```sh
go run ./cmd/main.go
```

The main function now demonstrates more realistic repository usage:
```go
appCtx, err := inject.InitializeEvent()
if err != nil {
    log.Fatalf("failed to initialize app context: %v", err)
}

// Demonstrate SQL repository usage
sqlRepo := appCtx.Repository.GetSql()
sqlRepo.GetConnection() // Simulate connecting to SQL DB
sqlRepo.GetSql()        // Simulate a SQL operation

// Demonstrate Cache repository usage
cacheRepo := appCtx.Repository.GetCache()
cacheRepo.GetConnection() // Simulate connecting to cache
cacheRepo.GetCache()      // Simulate a cache operation

// Direct access via AppContext fields
appCtx.SqlRepository.GetConnection()
appCtx.CacheRepository.GetConnection()
```

## Testing

Unit tests are provided for repository interfaces and the dependency injection setup. To run the tests:

```sh
go test ./inject
```

The tests cover:
- Cache and SQL repository creation and connection methods
- The main `Repository` interface
- The `AppContext` initialization
- The Wire-generated dependency injection setup

## Extending the Template
- Add new services or repositories by defining interfaces and implementations in `injector.go`.
- Register new providers in `wire.go` using `wire.NewSet`.
- Regenerate the injector with `wire` after making changes.
- Add or update tests in `injector_test.go` as needed.

## References
- [Google Wire Documentation](https://github.com/google/wire)

## License
MIT